#!perl -ln
sub L{$Z=$b[$k=pop];my%t;$l[$Z]=[grep!$t{$_}++,@{$l[$Z]},@_]if
pop()?$b[pop]eq$":$Z>0}sub
S{($m,$n)=@_;($M,$N)=sort$$m,$$n;L@{delete$l[$N]},0,$c
if$N!=($$m=$$n=$M)}$i=1;for(split//){$b[$c=$..$i]=/w/?++$e:$_;$x=($R=$.-1).$i;$y=$..($C=$i-1);/w/&&do{$b[$_]>0&&S\$b[$c],\$b[$_]for$x,$y;L"$R $i",$x,1,$c;L"$. $C",$y,1,$c};/ /&&do{L"$. $i",0,$x;L"$. $i",0,$y};$i++}}{print
for sort grep!$s{$_}++,map@$_-1?():@$_,@l
